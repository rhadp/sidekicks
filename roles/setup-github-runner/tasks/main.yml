# Do not modify this file.
# Implement pre-/post-install, install/uninstall tasks in their own files.

- name: running initial tasks
  include_tasks:
    file: ./initial.yml
    apply:
      become: "{{ become_override | bool }}"

- name: running pre-install tasks
  include_tasks:
    file: ./pre_install.yml
    apply:
      become: "{{ become_override | bool }}"
  vars:
    ansible_user: "{{ ssh_username }}"
    ansible_ssh_private_key_file: "{{ ssh_key_path | regex_replace('\\.pub$', '') }}"
    ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
  when: ACTION == "INSTALL"

- name: running install tasks
  include_tasks:
    file: ./install.yml
    apply:
      become: "{{ become_override | bool }}"
  vars:
    ansible_user: "{{ ssh_username }}"
    ansible_ssh_private_key_file: "{{ ssh_key_path | regex_replace('\\.pub$', '') }}"
    ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
  when: ACTION == "INSTALL" #or ACTION == "UPDATE"

- name: running post install tasks
  include_tasks:
    file: ./post_install.yml
    apply:
      become: "{{ become_override | bool }}"
  vars:
    ansible_user: "{{ ssh_username }}"
    ansible_ssh_private_key_file: "{{ ssh_key_path | regex_replace('\\.pub$', '') }}"
    ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
  when: ACTION == "INSTALL" or ACTION == "UPDATE"

- name: running uninstall tasks
  include_tasks:
    file: ./uninstall.yml
    apply:
      become: "{{ become_override | bool }}"
  vars:
    ansible_user: "{{ ssh_username }}"
    ansible_ssh_private_key_file: "{{ ssh_key_path | regex_replace('\\.pub$', '') }}"
    ansible_ssh_common_args: "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null"
  when: ACTION == "UNINSTALL" and instance_public_ip is defined
